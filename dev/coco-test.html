<html>

<head>
  <meta charset="UTF-8">
  <title>Webcam Image Classification using MobileNet and p5.js</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/addons/p5.dom.min.js"></script>
  <script src="https://unpkg.com/ml5@0.1.1/dist/ml5.min.js" type="text/javascript"></script>
  
</head>

<body>
  <p>
      The MobileNet model labeled this as <span id="result">...</span>
    <br/>with a confidence of <span id="probability">...</span>.
  </p>
<script>

let classifier;
let video;

function setup() {
  //noCanvas();
  //createCanvas(200,200);
  createCanvas(displayWidth, displayHeight - 100);
  
  if (isMobileDevice()) {
  	console.log("mobile device");
  var constraints = {
    audio: false,
    video: {
      facingMode: {
        exact: "environment"
      }
    }
  };
  
  video = createCapture(constraints);
  } else {
  	console.log("NOT mobile device");
    video = createCapture(VIDEO);
  }
  
  //video.size(640, 480);
  video.hide();
  
  // Initialize the Image Classifier method with MobileNet and the video as the second argument
  // classifier = ml5.imageClassifier('MobileNet', video, modelReady);  
  cocoSsd = ml5.objectDetector('cocossd', detectNow);


  button.mousePressed(greet);
}

function draw() {
 image(video, 0, 0, width, height);
 //image(video,0,0, 200, 200);
  
}

function isMobileDevice() {
    return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
}


function modelReady() {
  // Change the status of the model once its ready
  // Call the classifyVideo function to start classifying the video
  classifyVideo();
}

// Get a prediction for the current video frame
// function classifyVideo() {
//   classifier.predict(gotResult);
// }

function detectNow() {
  console.log("Model ready!");
  cocoSsd.detect(capture, gotResult);
}

// When we get a result
function gotResult(err, results) {
  // The results are in an array ordered by probability.
  select('#result').html(results[0].className);
  // select('#probability').html(nf(results[0].probability, 0, 2));
  // classifyVideo();
  detectNow();
}

</script>
</body>

</html>