<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js" integrity="sha512-WJXVjqeINVpi5XXJ2jn0BSCfp0y80IKrYh731gLRnkAS9TKc5KNt/OfLtu+fCueqdWniouJ1ubM+VI/hbo7POQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.8/addons/p5.dom-min.js"></script> -->
    <script src="p5.min.js"></script>
    <script src="p5.dom.min.js"></script> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM Plex Mono">
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <title>digital solidarity</title>
</head>
<body>
<script>
/*
0.74 meter per step

â‰ˆ 0.70 meter per step
measure your height in centimetres, 
then if you are female multiply this by 1.14, 
and if you are male, multiply your height by 1.35


GPS Tracker -> Distance between 2 Points -> METERS & TIME
Body Height -> stride length -> 
distance meters / stride length = STEPS
time & meters -> meters per second -> km/h -> animation SPEED

*/

let autoLogStatus = false; // Boolean for setInterval function getLocation
let currentdate = new Date(); 
let button1, button2, button3, statusTime, statusLog;
let totalSeconds = 0; // timer second variable

let dataGPS = {
    "type": "Feature",
    "geometry": {
      "type": "Point",
      "coordinates": []
    },
    "properties": {
      "name": currentdate.getDate() + "/" + (currentdate.getMonth()+1)  + "/" + currentdate.getFullYear() + '@' + currentdate.getHours() + ":"  + currentdate.getMinutes() + ":" + currentdate.getSeconds(),
      'date' : [],
      'time' : []
    }
  };

function preload() {
}

function setup() {
  createCanvas(windowWidth, windowHeight);
  background('black');

  statusTime = createDiv('press "start walking </br> and allow location access"');
  statusTime.position(0, windowHeight/8 * 0);
  statusTime.size( windowWidth, windowHeight/8);
  statusTime.style('font-family', 'IBM Plex Mono')
  statusTime.style('text-align', 'center')
  statusTime.style('margin', 0);
  statusTime.style('padding-top', '6.25%');
  statusTime.style('background-color', 'black');
  statusTime.style('color', 'white');
  statusTime.style('border', 'none');
  statusTime.style('font-size', '1em');
  statusTime.style('z-index', 1)

  statusLog = createP('every 10 sec the </br> location will be fetched');
  statusLog.position(0, windowHeight/8 * 1);
  statusLog.size( windowWidth, windowHeight/8);
  statusLog.style('font-family', 'IBM Plex Mono')
  statusLog.style('text-align', 'center')
  // statusLog.style('margin', 0);
  // statusTime.style('margin-top', '6.25%');
  // statusTime.style('padding-left', '10px');
  // statusTime.style('padding-right', '10px');
  statusLog.style('background-color', 'black');
  statusLog.style('color', 'white');
  statusLog.style('border', 'none');
  statusLog.style('font-size', '1em');
  statusLog.style('z-index', 1)

  // statusTime.mousePressed(logStatusOn);

  button1 = createButton('[ start protest ]');
  button1.position(0, windowHeight/4 * 1);
  button1.size( windowWidth, windowHeight/4);
  button1.style('font-family', 'IBM Plex Mono')
  button1.style('font', 'black');
  button1.style('background-color', 'black');
  button1.style('color', 'white');
  button1.style('border', 'none');
  button1.style('font-size', '1.8em');
  button1.style('z-index', 1)
  button1.mousePressed(logStatusOn);

  button2 = createButton('[ pause ]');
  button2.position(0, windowHeight/4 * 2);
  button2.size( windowWidth, windowHeight/4);
  button2.style('font-family', 'IBM Plex Mono')
  button2.style('background-color', 'black');
  button2.style('color', 'white');
  button2.style('border', 'none');
  button2.style('font-size', '1.8em');
  button2.mousePressed(logStatusOff);

  button3 = createButton('[ save data ]');
  button3.position(0, windowHeight/4 * 3);
  button3.size( windowWidth, windowHeight/4);
  button3.style('font-family', 'IBM Plex Mono')
  button3.style('background-color', 'black');
  button3.style('color', 'white');
  button3.style('border', 'none');
  button3.style('font-size', '1.8em');
  button3.mousePressed(saveLog);
}


function draw() {
  statusTime.html()
}

setInterval(logData, 10000);

// activate timer when autoLogStatus=true is being called
setInterval(function() {let date = new Date;}, 1000); // for timer 1second
setInterval(setTime, 1000); // timer

function setTime() {
  if (autoLogStatus === true) {
    ++totalSeconds;
    let sec = pad(totalSeconds % 60);
    let min = pad(parseInt(totalSeconds / 60));
    statusTime.html(min + ':' + sec);
  }
}

function pad(val) {
  var valString = val + "";
  if (valString.length < 2) {
    return "0" + valString;
  } else {
    return valString;
  }
}

function logStatusOn() {
  autoLogStatus = true;
  button2.style('background-color', 'black');
  button2.style('color', 'white');
  button1.style('background-color', 'yellow');
  button1.style('color', 'black');
  console.log('autoLogStatus=true')
}

function logStatusOff() {
  autoLogStatus = false;
  button1.style('background-color', 'black');
  button1.style('color', 'white');
  button2.style('background-color', 'yellow');
  button2.style('color', 'black');
  console.log('autoLogStatus=false')
}

function saveLog() {
  saveJSON(dataGPS, dataGPS.properties.name);
  button3.style('background-color', 'green');
  console.log('save log')
}

function logData() {
  if (autoLogStatus === true) {
    getLocation();
    getDatetime();
    console.log(dataGPS);
    statusLog.html('Location log: ' + dataGPS.geometry.coordinates.length)
  }
} 

function getLocation() {
    navigator.geolocation.getCurrentPosition(getposition);
    // console.log('getPosition');
}

function getDatetime() {
  currentdate = new Date(); 
  dataGPS.properties.date.push([currentdate.getDate() + "/" + (currentdate.getMonth()+1)  + "/" + currentdate.getFullYear()]);
  dataGPS.properties.time.push([currentdate.getHours() + ":"  + currentdate.getMinutes() + ":" + currentdate.getSeconds()]);
  // console.log('dataGPSdatetime',dataGPS.properties);
}

function getposition(position) {
    let lat = position.coords.latitude
    let lon = position.coords.longitude
    // console.log('lat & lon',lat, lon)
    dataGPS.geometry.coordinates.push([lat, lon]);
    // console.log('dataGPS',dataGPS.geometry.coordinates)
}

function keyPressed() {
  // keycode 83 = 'S'
  if (keyCode === 83) {
    console.log('s');
    saveJSON(dataGPS, dataGPS.properties.name);
  // keycode 88 = 'X'
  } else if (keyCode === 88) {
    autoLogStatus = true;
    console.log('autoGPS active!');
  // keycode 67 = 'X'
  } else if (keyCode === 67) {
    autoLogStatus = false;
    console.log('autoGPS off!');
  }
}

function mousePressed() {
  // console.log('getPosition mousePressed');
  // logData();
  // console.log(dataGPS)
}
 ////////////////////////////////////////////////////// GPS LOCATION TRACKER
////////////////////////////////////////////////////// GPS LOCATION TRACKER


/* ////////////////////////////////////////////////////// DISTANCE BETWEEN TWP GPS POSITIONS IN METERS
function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
  var R = 6371; // Radius of the earth in km
  var dLat = deg2rad(lat2-lat1);  // deg2rad below
  var dLon = deg2rad(lon2-lon1); 
  var a = 
    Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
    Math.sin(dLon/2) * Math.sin(dLon/2)
    ; 
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
  var d = R * c; // Distance in km
  return d;
}

function deg2rad(deg) {
  return deg * (Math.PI/180)
}
////////////////////////////////////////////////////// DISTANCE BETWEEN TWP GPS POSITIONS IN METERS */


/* //////////////////////////////////////////////////////SAVE STRINGS
let words = 'apple bear cat dog';

// .split() outputs an Array
let list = split(words, ' ');

function setup() {
createCanvas(100, 100);
background(200);
text('click here to save', 10, 10, 70, 80);
describe('no image displayed');
}

function mousePressed() {
if (mouseX > 0 && mouseX < width && mouseY > 0 && mouseY < height) {
  saveStrings(list, 'nouns.txt');
}
}

// Saves the following to a file called 'nouns.txt':
//
// apple
// bear
// cat
// dog
//////////////////////////////////////////////////////SAVE STRINGS */ 

/* ////////////////////////////////////////////////////// STOPWATCH
//Stop Watch
//Play with model scaling it to real time
let S;
let t=0;
let dt=0.1;
function setup() {
  createCanvas(400, 400);
  S=0;
}

function draw() {
  background(220);
  text("Press mouse to start and stop watch",100,100);
  if (S===1){
  t=t+dt;
  }
  text(t,200,200);
}
function touchStarted(){
if (S===0)
S=1;
else
S=0;

}
////////////////////////////////////////////////////// STOPWATCH */

</script>
    
</body>
</html>